@page
@model LoCoMPro.Pages.DetallesRegistro.DetallesRegistroModel
@{
    ViewData["Title"] = "Detalles Registro";
}

<!-- Metadatos -->
<head>
    <!-- Titulo de la página -->
    <title>Detalles Registro</title>
    <!-- Incluye su archivo de estilo CSS específico -->
    <link rel="stylesheet" href="~/css/Pages/DetallesRegistro/DetallesRegistro.css" asp-append-version="true" />
    <!-- Incluye archivo para las estrellas utilizadas en la calificación -->
    <link rel="stylesheet" type="text/css" href="~/css/Pages/Shared/starability-growRotate.css" />
</head>

<!-- Cuerpo de la página -->
<body>
    <div class="Contenedor-central">
        <!-- Contenedor para una fila -->
        <div class="Contenedor-fila" style="margin-left:5%;">
            <div class="Contenedor-columna">
                <span class="Etiqueta">Producto:</span>
                <span class="Etiqueta">Precio:</span>
                <span class="Etiqueta">Unidad:</span>
                <span class="Etiqueta-final">Descripción:</span>
            </div>
            <div class="Contenedor-columna">
                <div class="Contenedor Caja-texto-larga">
                    <span class="Caja-texto">@Model.registro.productoAsociado</span>
                </div>
                <div class="Contenedor Caja-texto-larga">
                    <span class="Caja-texto">@Model.registro.precio</span>
                </div>
                <div class="Contenedor Caja-texto-larga">
                    <span class="Caja-texto">@Model.registro.nombreUnidad</span>
                </div>
                <div class="Contenedor Caja-texto-larga">
                    <span class="Caja-texto-grande">@Model.registro.descripcion</span>
                </div>
            </div>
        </div>
        <div class="Contenedor-fila" style="margin-left:5%;">
            <div class="Contenedor-columna" style="margin-top:19%;">
                <span class="Etiqueta-calificacion">Calificación:</span>
            </div>
            <div class="Contenedor-columna">
                <div id="galeriaImagenes" class="GaleriaImagenes">
                    <div id="imagenAnterior" class="NavegacionImagen NavegacionImagen-Anterior" onclick="verImagenAnterior()">&lt;</div>
                    <div id="currentImage" class="CurrentImage">
                        <img id="vistaImagen" src="~/img/pinwino_no_disponible.png" alt="Product Image" class="Image">
                    </div>
                    <div id="siguienteImagen" class="NavegacionImagen NavegacionImagen-Siguiente" onclick="verImagenSiguiente()">&gt;</div>
                </div>
                <div class="Contenedor-calificacion">
                    <p class="starability-result" data-rating="@Math.Round(Model.registro.calificacion)"></p>
                    <p class="Calificacion">@Model.registro.calificacion.ToString("0.0") de 5,0</p>
                    <p class="Conteo">(1)</p>  @* TODO(Angie) <p class="Conteo">(@Model.cantidadAportes)</p>*@
                </div>
            </div>
        </div>
    </div>
    <div class="Boton">
        <input type="button" class="Boton-estandar" onclick="history.back()" value="Regresar" />
    </div>
</body>


<script>
    // Inicializa galería de imágenes
    var imagenes = @Html.Raw(Json.Serialize(Model.registro.fotografias));
    var indiceImagenActual = 0;
    var vistaImagen = document.getElementById("vistaImagen");
    var imagenAnterior = document.getElementById("imagenAnterior");
    var siguienteImagen = document.getElementById("siguienteImagen");

    function verImagenActual() {
        if (imagenes && imagenes.length > 0 && indiceImagenActual >= 0 && indiceImagenActual < imagenes.length) {
            vistaImagen.src = `data:image/jpeg;base64,${imagenes[indiceImagenActual].fotografia}`;
        }
        vistaImagen.className = "Imagen";
        actualizarVisibilidadFlecha();
    }

    // Esconde las flechas si no hay fotos antes y/o después
    function actualizarVisibilidadFlecha() {
        if (imagenes && imagenes.length > 0) {
            if (indiceImagenActual <= 0) {
                imagenAnterior.style.visibility = "hidden";
            } else {
                imagenAnterior.style.visibility = "visible";
            }

            if (indiceImagenActual >= imagenes.length - 1) {
                siguienteImagen.style.visibility = "hidden";
            } else {
                siguienteImagen.style.visibility = "visible";
            }
        } else {
            imagenAnterior.style.visibility = "hidden";
            siguienteImagen.style.visibility = "hidden";
        }
    }

    function verImagenAnterior() {
        if (indiceImagenActual > 0) {
            indiceImagenActual--;
            verImagenActual();
        }
    }

    function verImagenSiguiente() {
        if (indiceImagenActual < imagenes.length - 1) {
            indiceImagenActual++;
            verImagenActual();
        }
    }

    // Muestra la primera imagen
    verImagenActual();
</script>