@page
@model LoCoMPro.Pages.VerRegistros.VerRegistrosModel
@{
    ViewData["Title"] = "Ver Registros";
}

<head>
    <link rel="stylesheet" href="~/css/Pages/VerRegistros/VerRegistros.css" asp-append-version="true" />
    <script src="~/js/Pages/Busqueda/paginador.js"></script>
    <script>
        // Función de traducción de codificación
        function traducirCodificacion(cadena) {
            var elementoTemporal = document.createElement("div");
            elementoTemporal.innerHTML = cadena;
            return elementoTemporal.textContent;
        }

        // Obtener resultados de busqueda principal
        function obtenerResultados() {
            var resultadosDecodificados = traducirCodificacion('@Model.resultadoRegistros')
            return JSON.parse(resultadosDecodificados);
        }

        var resultados = obtenerResultados();
        var paginador = new Paginador(5);
        var paginaDefault = 1;
    </script>
    <script src="~/js/Pages/VerRegistros/clienteVerRegistros.js?v=6117"></script>
</head>

<div>
    <div class="InfoProducto">
        <div class="VerRegistros-contenedor">
            <div class="VerRegistros-contenedor-fila">
                 <div class="ImageColumn">
                    <div id="galeriaImagenes" class="GaleriaImagenes">
                        <div id="imagenAnterior" class="NavegacionImagen NavegacionImagen-Anterior" onclick="verImagenAnterior()">&lt;</div>
                        <div id="currentImage" class="CurrentImage">
                            <img id="vistaImagen" src="~/img/pinwino_no_disponible.png" alt="Product Image" class="Image">
                        </div>
                        <div id="siguienteImagen" class="NavegacionImagen NavegacionImagen-Siguiente" onclick="verImagenSiguiente()">&gt;</div>
                    </div>
                </div>
                <div class="VerRegistros-contenedor-caja-texto">
                    <h2 class="TituloProducto">@Model.NombreProducto</h2>
                    <input type="hidden" id="nombreProducto" value="@Model.NombreProducto">
                    <div class="InfoProductoColumnas">
                        <div class="ContenedorInfoColumnas">
                            <div class="InfoColumn">
                                <p><strong>Tienda:</strong> @Model.NombreTienda</p>
                                <p><strong>Categoría:</strong> @Model.NombreCategoria</p>
                            </div>
                            <div class="InfoColumn">
                                <p><strong>Marca:</strong> @Model.NombreMarca</p>
                                <p><strong>Unidad:</strong> @Model.NombreUnidad</p>
                            </div>
                            <div class="InfoColumn">
                                <p><strong>Provincia:</strong> @Model.NombreProvincia</p>
                                <p><strong>Cantón:</strong> @Model.NombreCanton</p>
                            </div>
                        </div>
                    </div>
                </div>
               
            </div>
        </div>
    </div>

    <div class="VerRegistros-contenedor-fila">
        <div class="VerRegistros-agrupamientos">
            <div class="VerRegistros-contenedor-agrupamientos" id="Contenedoragrupamientos">
                <label class="InfoColumnBold">Agrupar por:</label>
                    <label>
                        <input type="checkbox" name="Día" value = "Día" /> Día
                    </label>
                    <label>
                        <input type="checkbox" name="Semana" value="Semana" /> Semana
                    </label>
                    <label>
                        <input type="checkbox" name="Mes" value="Mes" /> Mes
                    </label>
                    <label>
                        <input type="checkbox" name="Año" value="Año" /> Año
                    </label>
            </div>
        </div>
        <!-- Tablas de resultados -->
        <div class="VerRegistros-tabla">
            <table>
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Precio</th>
                        <th>Calificación</th>
                        <th>Descripción</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody class="VerRegistros-tabla-resultados" id="CuerpoResultados"> </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Paginación -->
<div class="VerRegistros-contenedor-paginacion">
    <div class="VerRegistros-contenedor-caja-paginacion">
        <div id="PaginaPrevia" class="VerRegistros-boton-paginacion" onclick="pasarPagina(productosVM.IndicePagina - 1)">
            Anterior
        </div>
        <div id="SinPaginaPrevia" class="VerRegistros-boton-paginacion-deshabilitado">
            Anterior
        </div>

        <span id="TextoPaginacion" class="VerRegistros-texto-paginacion">  </span>

        <div id="PaginaSiguiente" class="VerRegistros-boton-paginacion" onclick="pasarPagina(productosVM.IndicePagina + 1)">
            Siguiente
        </div>
        <div id="SinPaginaSiguiente" class="VerRegistros-boton-paginacion-deshabilitado">
            Siguiente
        </div>
    </div>
</div>


<script>
    var productosVM = paginar(paginaDefault);

    // Renderizar
    renderizarPaginacion();
    renderizarTabla(productosVM);
</script>

<script>
    // Initialize the image gallery
    var imagenes = @Html.Raw(Json.Serialize(Model.fotografias));
    var indiceImagenActual = 0;
    var vistaImagen = document.getElementById("vistaImagen");
    var imagenAnterior = document.getElementById("imagenAnterior");
    var siguienteImagen = document.getElementById("siguienteImagen");

    function verImagenActual() {
        if (imagenes && imagenes.length > 0 && indiceImagenActual >= 0 && indiceImagenActual < imagenes.length) {
            vistaImagen.src = `data:image/jpeg;base64,${imagenes[indiceImagenActual].fotografia}`;  
        }
        vistaImagen.className = "Imagen";
        // Update the arrow visibility
        actualizarVisibilidadFlecha();
    }

    function actualizarVisibilidadFlecha() {
        if (imagenes && imagenes.length > 0) {
            if (indiceImagenActual <= 0) {
                imagenAnterior.style.visibility = "hidden";
            } else {
                imagenAnterior.style.visibility = "visible";
            }

            if (indiceImagenActual >= imagenes.length - 1) {
                siguienteImagen.style.visibility = "hidden";
            } else {
                siguienteImagen.style.visibility = "visible";
            }
        } else {
            // Hide the arrows when there are no imagenes
            imagenAnterior.style.visibility = "hidden";
            siguienteImagen.style.visibility = "hidden";
        }
    }

    // Function to show the Anterior image
    function verImagenAnterior() {
        if (indiceImagenActual > 0) {
            indiceImagenActual--;
            verImagenActual();
        }
    }

    // Function to show the Siguiente image
    function verImagenSiguiente() {
        if (indiceImagenActual < imagenes.length - 1) {
            indiceImagenActual++;
            verImagenActual();
        }
    }

    // Initial display of the first image
    verImagenActual();
</script>



